BC (CTB 100)
=======

Link: https://hy17-bc.spb.ctf.su/

Зайдя на страницу видим калькулятор и ссылку на его исходный код (https://hy17-bc.spb.ctf.su/?source). 
Из сурцов нас интересуют несколько строк:
```php
if (preg_match('#[g-wy-z]#si', $expr)) { 
    echo "<span class='err'>Only hex letters A-F can be used</span>"; 
}else{
...
	$output = trim(shell_exec("bc 2>&1 <<<'$expr'")); 
}
```


```php
if (preg_match('#[g-wy-z]#si', $expr))
```

Эта строка проверяет ввод на запрещенные символы.  Конкретнее - исключает символы от g до w и от y до z из введенного текста.
Больше никакой фильтрации ввода на видим.
Имеем: фильтруются буквы в вышесказанном интервале. Но мы можем использовать `x` помимо хекс символов.

Далее смотрим на исполнение кода:

```php
    $output = trim(shell_exec("bc 2>&1 <<<'$expr'")); 
```

Подставляя вместо `$expr`, к примеру, `1+1';df;'` получаем синтаксически верный запрос, состоящий из трех последовательных команд: посчитать с помощью bc, выполнить df и после пустую строку. Пробуем вывести этот запрос:


![enter image description here](https://i.imgur.com/WR1IIkd.png)


Успех! У нас есть исполнение кода. Осталось понять, как можно вывести флаг, ведь вводимые символы ограничены и традиционными средствами текст не вывести (например, `cat` или `head`)

В выводе нам поможет то. что проверка допускает использование символа `x`. Команда `xxd` позволяет вывести содержимое файла в hex представлении одновременно с обычным и не содержит запрещенных для ввода символов. Флаг, очевидно, находится в файле, название которого начинается со слова `flag`, но там есть запрещенные символы. `xxd` разрешает пользоваться масками для ввода названия файлов. Пробуем `f*`:

![enter image description here](https://i.imgur.com/bdcbDGF.png)


Флаг - правая колонка символов:  

> hy17{9edd3d10987207dc1f97a9bfc6af269f}
